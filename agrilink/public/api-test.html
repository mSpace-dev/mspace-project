<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriLink API Test Client</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .api-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        h1 {
            color: #2c5530;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #2c5530;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }
        .test-form {
            margin: 15px 0;
        }
        input, select, textarea, button {
            margin: 5px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        input, select, textarea {
            min-width: 200px;
        }
        textarea {
            width: 100%;
            height: 100px;
            resize: vertical;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        .response {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .endpoint {
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŒ¾ AgriLink API Test Client</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            Test the AgriLink backend APIs directly from your browser. Make sure your Next.js development server is running on port 3000.
        </p>

        <!-- Prices API -->
        <div class="api-section">
            <h2>ðŸ“Š Prices API</h2>
            
            <div class="test-form">
                <h3>GET <span class="endpoint">/api/prices</span></h3>
                <input type="text" id="pricesCrop" placeholder="Crop (e.g., rice)" />
                <input type="text" id="pricesDistrict" placeholder="District (e.g., colombo)" />
                <input type="text" id="pricesProvince" placeholder="Province (e.g., western)" />
                <button onclick="testGetPrices()">Get Prices</button>
                <div id="pricesResponse" class="response"></div>
            </div>

            <div class="test-form">
                <h3>POST <span class="endpoint">/api/prices</span></h3>
                <input type="text" id="newCrop" placeholder="Crop name" />
                <input type="text" id="newVariety" placeholder="Variety" />
                <input type="number" id="newPrice" placeholder="Price" step="0.01" />
                <input type="text" id="newUnit" placeholder="Unit (kg/piece)" />
                <input type="text" id="newMarket" placeholder="Market" />
                <input type="text" id="newDistrict" placeholder="District" />
                <input type="text" id="newProvince" placeholder="Province" />
                <button onclick="testAddPrice()">Add Price</button>
                <div id="addPriceResponse" class="response"></div>
            </div>
        </div>

        <!-- Alerts API -->
        <div class="api-section">
            <h2>ðŸ”” Alerts API</h2>
            
            <div class="test-form">
                <h3>POST <span class="endpoint">/api/alerts</span></h3>
                <input type="text" id="alertUserId" placeholder="User ID" value="user123" />
                <input type="text" id="alertCrop" placeholder="Crop" value="Rice" />
                <input type="number" id="alertThreshold" placeholder="Price threshold" step="0.01" value="80" />
                <select id="alertCondition">
                    <option value="above">Above</option>
                    <option value="below">Below</option>
                    <option value="change">Price Change</option>
                </select>
                <input type="text" id="alertPhone" placeholder="Phone (+94XXXXXXXXX)" value="+94771234567" />
                <input type="email" id="alertEmail" placeholder="Email (optional)" />
                <button onclick="testCreateAlert()">Create Alert</button>
                <div id="createAlertResponse" class="response"></div>
            </div>

            <div class="test-form">
                <h3>GET <span class="endpoint">/api/alerts</span></h3>
                <input type="text" id="getUserAlerts" placeholder="User ID" value="user123" />
                <button onclick="testGetAlerts()">Get User Alerts</button>
                <div id="getAlertsResponse" class="response"></div>
            </div>
        </div>

        <!-- Forecasts API -->
        <div class="api-section">
            <h2>ðŸ“ˆ Forecasts API</h2>
            
            <div class="test-form">
                <h3>GET <span class="endpoint">/api/forecasts</span></h3>
                <input type="text" id="forecastCrop" placeholder="Crop" value="Rice" />
                <input type="number" id="forecastDays" placeholder="Days (1-30)" value="7" min="1" max="30" />
                <select id="forecastModel">
                    <option value="ARIMA">ARIMA</option>
                    <option value="LSTM">LSTM</option>
                    <option value="hybrid">Hybrid</option>
                </select>
                <button onclick="testGetForecast()">Get Forecast</button>
                <div id="forecastResponse" class="response"></div>
            </div>
        </div>

        <!-- Users API -->
        <div class="api-section">
            <h2>ðŸ‘¤ Users API</h2>
            
            <div class="test-form">
                <h3>POST <span class="endpoint">/api/users/register</span></h3>
                <input type="text" id="userName" placeholder="Full name" value="John Farmer" />
                <input type="text" id="userPhone" placeholder="Phone (+94XXXXXXXXX)" value="+94771234567" />
                <input type="email" id="userEmail" placeholder="Email" value="john@example.com" />
                <select id="userType">
                    <option value="farmer">Farmer</option>
                    <option value="seller">Seller</option>
                    <option value="consumer">Consumer</option>
                    <option value="trader">Trader</option>
                </select>
                <input type="text" id="userDistrict" placeholder="District" value="Colombo" />
                <input type="text" id="userProvince" placeholder="Province" value="Western" />
                <button onclick="testRegisterUser()">Register User</button>
                <div id="registerUserResponse" class="response"></div>
            </div>
        </div>

        <!-- Chatbot API -->
        <div class="api-section">
            <h2>ðŸ¤– Chatbot API</h2>
            
            <div class="test-form">
                <h3>POST <span class="endpoint">/api/chatbot</span></h3>
                <textarea id="chatMessage" placeholder="Enter your message... Try: 'What is the current rice price?' or 'help'">What is the current rice price?</textarea>
                <input type="text" id="chatUserPhone" placeholder="Phone (optional)" value="+94771234567" />
                <button onclick="testChatbot()">Send Message</button>
                <div id="chatbotResponse" class="response"></div>
            </div>
        </div>

        <!-- SMS API -->
        <div class="api-section">
            <h2>ðŸ“± SMS API</h2>
            
            <div class="test-form">
                <h3>POST <span class="endpoint">/api/sms/send</span></h3>
                <input type="text" id="smsPhone" placeholder="Phone (+94XXXXXXXXX)" value="+94771234567" />
                <textarea id="smsMessage" placeholder="SMS message">ðŸ”” AgriLink Test: Rice price is now Rs.85.50/kg</textarea>
                <button onclick="testSendSMS()">Send SMS</button>
                <div id="smsResponse" class="response"></div>
            </div>
        </div>

        <!-- Analytics API -->
        <div class="api-section">
            <h2>ðŸ“Š Analytics API (Admin)</h2>
            
            <div class="test-form">
                <h3>GET <span class="endpoint">/api/analytics</span></h3>
                <select id="analyticsPeriod">
                    <option value="1d">1 Day</option>
                    <option value="7d" selected>7 Days</option>
                    <option value="30d">30 Days</option>
                    <option value="90d">90 Days</option>
                </select>
                <button onclick="testGetAnalytics()">Get Analytics</button>
                <div id="analyticsResponse" class="response"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        const ADMIN_API_KEY = 'admin-key-123';

        async function makeRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { data, status: response.status };
            } catch (error) {
                return { error: error.message, status: 0 };
            }
        }

        function displayResponse(elementId, response) {
            const element = document.getElementById(elementId);
            element.className = 'response';
            
            if (response.error) {
                element.className += ' error';
                element.textContent = `Error: ${response.error}`;
            } else if (response.status >= 400) {
                element.className += ' error';
                element.textContent = JSON.stringify(response.data, null, 2);
            } else {
                element.className += ' success';
                element.textContent = JSON.stringify(response.data, null, 2);
            }
        }

        async function testGetPrices() {
            const crop = document.getElementById('pricesCrop').value;
            const district = document.getElementById('pricesDistrict').value;
            const province = document.getElementById('pricesProvince').value;
            
            const params = new URLSearchParams();
            if (crop) params.append('crop', crop);
            if (district) params.append('district', district);
            if (province) params.append('province', province);
            
            const response = await makeRequest(`/prices?${params}`);
            displayResponse('pricesResponse', response);
        }

        async function testAddPrice() {
            const body = {
                crop: document.getElementById('newCrop').value,
                variety: document.getElementById('newVariety').value,
                price: parseFloat(document.getElementById('newPrice').value),
                unit: document.getElementById('newUnit').value,
                market: document.getElementById('newMarket').value,
                district: document.getElementById('newDistrict').value,
                province: document.getElementById('newProvince').value
            };
            
            const response = await makeRequest('/prices', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            displayResponse('addPriceResponse', response);
        }

        async function testCreateAlert() {
            const body = {
                userId: document.getElementById('alertUserId').value,
                crop: document.getElementById('alertCrop').value,
                priceThreshold: parseFloat(document.getElementById('alertThreshold').value),
                condition: document.getElementById('alertCondition').value,
                phone: document.getElementById('alertPhone').value,
                email: document.getElementById('alertEmail').value || undefined
            };
            
            const response = await makeRequest('/alerts', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            displayResponse('createAlertResponse', response);
        }

        async function testGetAlerts() {
            const userId = document.getElementById('getUserAlerts').value;
            const response = await makeRequest(`/alerts?userId=${userId}`);
            displayResponse('getAlertsResponse', response);
        }

        async function testGetForecast() {
            const crop = document.getElementById('forecastCrop').value;
            const days = document.getElementById('forecastDays').value;
            const model = document.getElementById('forecastModel').value;
            
            const response = await makeRequest(`/forecasts?crop=${crop}&days=${days}&model=${model}`);
            displayResponse('forecastResponse', response);
        }

        async function testRegisterUser() {
            const body = {
                name: document.getElementById('userName').value,
                phone: document.getElementById('userPhone').value,
                email: document.getElementById('userEmail').value,
                type: document.getElementById('userType').value,
                district: document.getElementById('userDistrict').value,
                province: document.getElementById('userProvince').value,
                crops: ['Rice', 'Coconut']
            };
            
            const response = await makeRequest('/users/register', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            displayResponse('registerUserResponse', response);
        }

        async function testChatbot() {
            const body = {
                message: document.getElementById('chatMessage').value,
                userPhone: document.getElementById('chatUserPhone').value || undefined,
                userId: 'user123'
            };
            
            const response = await makeRequest('/chatbot', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            displayResponse('chatbotResponse', response);
        }

        async function testSendSMS() {
            const body = {
                phone: document.getElementById('smsPhone').value,
                message: document.getElementById('smsMessage').value,
                type: 'test'
            };
            
            const response = await makeRequest('/sms/send', {
                method: 'POST',
                body: JSON.stringify(body)
            });
            displayResponse('smsResponse', response);
        }

        async function testGetAnalytics() {
            const period = document.getElementById('analyticsPeriod').value;
            
            const response = await makeRequest(`/analytics?period=${period}`, {
                headers: {
                    'x-api-key': ADMIN_API_KEY
                }
            });
            displayResponse('analyticsResponse', response);
        }

        // Load initial data on page load
        window.addEventListener('load', () => {
            testGetPrices();
        });
    </script>
</body>
</html>
